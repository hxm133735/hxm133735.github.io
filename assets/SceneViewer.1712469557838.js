import{A as $,h as S,l as ge,Q,a as N,b as D,V as F,j as V,F as we,a5 as he,R as ve,W as B,P as H,T as Ce,ax as ye,ay as _e,e as Te,a0 as X,a9 as Ee,o as R,U as ae}from"./vue.1712469557838.js";import{s as b,C as U,b as k,P as se,c as J,I as j,d as L,e as O,S as be,H as Ie,V as De,E as xe,_ as Se}from"./index.1712469557838.js";import{g as le,a as ke}from"./camera.1712469557838.js";var T=63710088e-1,Pe={centimeters:T*100,centimetres:T*100,degrees:T/111325,feet:T*3.28084,inches:T*39.37,kilometers:T/1e3,kilometres:T/1e3,meters:T,metres:T,miles:T/1609.344,millimeters:T*1e3,millimetres:T*1e3,nauticalmiles:T/1852,radians:1,yards:T*1.0936};function Ve(o,e,i){i===void 0&&(i={});var r={type:"Feature"};return(i.id===0||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=e||{},r.geometry=o,r}function ee(o,e,i){if(i===void 0&&(i={}),!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!te(o[0])||!te(o[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:o};return Ve(r,e,i)}function Me(o,e){e===void 0&&(e="kilometers");var i=Pe[e];if(!i)throw new Error(e+" units is invalid");return o*i}function z(o){var e=o%360;return e*Math.PI/180}function te(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function ie(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return o.geometry.coordinates;if(o.type==="Point")return o.coordinates}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return o;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ae(o,e,i){i===void 0&&(i={});var r=ie(o),t=ie(e),a=z(t[1]-r[1]),s=z(t[0]-r[0]),n=z(r[1]),c=z(t[1]),d=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(n)*Math.cos(c);return Me(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),i.units)}class Oe{constructor(e){this.Entity=e}updatePosition(e,i,r,t,a,s){i||(i=new Date(window.viewer.clock.currentTime.toString()).getTime()),r||(r=(e.length-1)*2e3);let n=Cesium.JulianDate.fromIso8601(new Date(i).toISOString());const c=this.transfrom2SampledPosition(e,n,t);this.Entity.position=c,this.Entity.orientation=new Cesium.VelocityOrientationProperty(c),a&&(this.Entity.path={show:!0,resolution:5,material:s,width:3}),this.Entity.userData&&(this.Entity.userData.loaded=!0),t&&this.updateAvailability(i,r,a,s)}updateAvailability(e,i){let r=Cesium.JulianDate.fromIso8601(new Date(e).toISOString()),t=Cesium.JulianDate.fromIso8601(new Date(e+i).toISOString());this.Entity.availability=new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:r,stop:t})])}transfrom2SampledPosition(e,i,r=!1){const t=new Cesium.SampledPositionProperty;r||(t.forwardExtrapolationType=Cesium.ExtrapolationType.HOLD);for(let a=0;a<e.length;a++){let s=e[a].time;const n=Cesium.JulianDate.addSeconds(i,s,new Cesium.JulianDate),c=Cesium.Cartesian3.fromDegrees(e[a].coordinate.longitude,e[a].coordinate.latitude,e[a].coordinate.altitude?e[a].coordinate.altitude+4:0,Cesium.Ellipsoid.WGS84);n&&c&&t.addSample(n,c)}return t}}const Le=b.state.startTime;class Be{constructor(e){e.side==="\u84DD\u65B9"?e.color="rgba(8,93,252,0.52)":e.side==="\u7EA2\u65B9"&&(e.color="rgba(252,8,8,0.52)");const i=this.createEntity(e),r=window.viewer.entities.add(i);e.route&&e.route.length&&(e.route.unshift({time:0,coordinate:e.coordinate}),new Oe(r).updatePosition(e.route,Le,e.route[e.route.length-1].time*1e3,!1,!0,e.color))}createEntity(e){if(e.route&&e.route.length){const t=[];e.route.forEach(a=>{t.push(a.coordinate.longitude),t.push(a.coordinate.latitude)}),Cesium.Cartesian3.fromDegreesArray(t),Cesium.Color.fromCssColorString(e.color)}let i=0,r={semiMinorAxis:150,semiMajorAxis:150,outline:!0,material:"./circle.png",stRotation:new Cesium.CallbackProperty(()=>(i+=.05,i),!1),show:!1,outlineWidth:40,outlineColor:U.WHITE};return{label:{heightReference:Cesium.HeightReference.RELATIVE_TO_GROUND,text:e.name,show:!0,font:"500 35px Helvetica",scale:.5,backgroundPadding:new Cesium.Cartesian2(10,8),fillColor:Cesium.Color.fromCssColorString("#fff"),eyeOffset:new Cesium.Cartesian3(0,10,-10),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,pixelOffset:new Cesium.Cartesian2(0,-48),showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY,outlineColor:Cesium.Color.fromCssColorString("rgba(0,0,0,0.52)"),outlineWidth:0,backgroundColor:Cesium.Color.fromCssColorString(e.color).withAlpha(.4)},heightReference:Cesium.HeightReference.ABSOLUTE,billboard:{pixelOffset:new Cesium.Cartesian2(0,e.name.indexOf("\u673A")>-1?24:12),eyeOffset:new Cesium.Cartesian3(0,0,0),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,image:`./icon/${e.modelUrl}`,width:48,height:e.name.indexOf("\u673A")>-1?48:24},show:e.show,position:Cesium.Cartesian3.fromDegrees(e.coordinate.longitude,e.coordinate.latitude,e.coordinate.altitude?e.coordinate.altitude+4:0,Cesium.Ellipsoid.WGS84),plane:{},ellipse:r,id:e.id,userData:e}}}function He(o){return new Cesium.Viewer(o,{animation:!1,timeline:!0,shouldAnimate:!1,homeButton:!1,fullscreenButton:!1,baseLayerPicker:!1,geocoder:!1,sceneModePicker:!1,navigationHelpButton:!1,infoBox:!1,sceneMode:3,orderIndependentTranslucency:!1,imageryProvider:new Cesium.UrlTemplateImageryProvider({url:"https://p2.map.gtimg.com/sateTiles/{z}/{sx}/{sy}/{x}_{reverseY}.jpg?version=400",customTags:{sx:function(e,i,r,t){return i>>4},sy:function(e,i,r,t){return(1<<t)-r>>4}}}),contextOptions:{requestWebgl1:!0,webgl:{alpha:!0}}})}function Ue(o,e){window.viewer.timeline.zoomTo(Cesium.JulianDate.fromIso8601(o.toISOString()),Cesium.JulianDate.fromIso8601(e.toISOString()))}function g(o){return window.viewer.entities.getById(o)}function h(o){o.show&&(o.show=!1),window.viewer.entities.remove(o)}function Ne(o){window.viewer.entities.remove(g(o))}function Fe(){Cesium.Timeline.prototype.makeLabel=function(o){new Date(window.viewer.clock.currentTime.toString());const e=Cesium.JulianDate.addHours(o,8,new Cesium.JulianDate),i=Cesium.JulianDate.toGregorianDate(e),r=i.millisecond;let t="UTC";if(r>0&&this._timeBarSecondsSpan<3600){for(t=Math.floor(r).toString();t.length<3;)t="0"+t;t="."+t}let a=i.hour;a<10&&(a="0"+a);let s=i.minute;s<10&&(s="0"+s);let n=i.second;return n<10&&(n="0"+n),i.year+"\u5E74"+i.month+"\u6708"+i.day+"\u65E5 "+a+":"+s+":"+n}}function Re(o){const e=o.getFullYear().toString().padStart(4,"0"),i=(o.getMonth()+1).toString().padStart(2,"0"),r=o.getDate().toString().padStart(2,"0"),t=o.getHours().toString().padStart(2,"0"),a=o.getMinutes().toString().padStart(2,"0"),s=o.getSeconds().toString().padStart(2,"0");return`${e}-${i}-${r} ${t}:${a}:${s}`}function Y(o){const i=window.viewer.scene.globe.ellipsoid.cartesianToCartographic(o);let r=Cesium.Math.toDegrees(i.longitude).toFixed(6),t=Cesium.Math.toDegrees(i.latitude).toFixed(6),a=i.height.toFixed(6);return Number.isInteger(r)&&(r=r.toFixed(1)),Number.isInteger(t)&&(t=t.toFixed(1)),Number.isInteger(a)&&(a=a.toFixed(1)),{longitude:parseFloat(r),latitude:parseFloat(t),altitude:parseFloat(a)}}class M{constructor(e,i,r={r:255,g:0,b:0}){this.viewer=window.viewer,this.color=r,this.createLine(e,i)}createLine(e,i){var a;let r={id:e.id},t;this.lineEntity=new Cesium.Entity(r),((a=e.entities)==null?void 0:a.length)===2?t={positions:new Cesium.CallbackProperty(()=>[e.entities[0].position.getValue(window.viewer.clock.currentTime),e.entities[1].position.getValue(window.viewer.clock.currentTime)],!1),width:15,material:this.initFlowLine(i,this.color),clampToGround:!1}:t={positions:e.positions,width:15,material:this.initFlowLine(i,this.color),clampToGround:!1},this.lineEntity.polyline=t,this.viewer.entities.add(this.lineEntity)}computeCircle(e=1){const i=[];for(let r=0;r<360;r++){const t=Cesium.Math.toRadians(r);i.push(new Cesium.Cartesian2(e*Math.cos(t),e*Math.sin(t)))}return i}initFlowLine(e,i={r:255,g:0,b:0}){function r(t,a){this._definitionChanged=new Cesium.Event,this._color=void 0,this._colorSubscription=void 0,this.color=t,this.duration=a,this._time=new Date(window.viewer.clock.currentTime.toString()).getTime()}return Object.defineProperties(r.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),r.prototype.getType=function(t){return"PolylineTrailLink"},r.prototype.getValue=function(t,a){return Cesium.defined(a)||(a={}),a.color=Cesium.Property.getValueOrClonedDefault(this._color,t,Cesium.Color.WHITE,a.color),a.image=Cesium.Material.PolylineTrailLinkImage,a.time=(new Date(window.viewer.clock.currentTime.toString()).getTime()-this._time)%this.duration/this.duration,a},r.prototype.equals=function(t){return this===t||t instanceof r&&Property.equals(this._color,t._color)},Cesium.Material.PolylineTrailLinkType="PolylineTrailLink",Cesium.Material.PolylineTrailLinkImage="./jt/"+e+".png",Cesium.Material.PolylineTrailLinkSource=`czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);
    vec2 st = materialInput.st;
    vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));
    material.alpha = colorImage.a * color.a;
    material.diffuse = (colorImage.rgb+color.rgb)/2.0;
    return material;
}`,Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineTrailLinkType,{fabric:{type:Cesium.Material.PolylineTrailLinkType,uniforms:{color:new Cesium.Color(1,0,0,.5),image:Cesium.Material.PolylineTrailLinkImage,time:0},source:Cesium.Material.PolylineTrailLinkSource},translucent:function(){return!0}}),new r(Cesium.Color.fromBytes(i.r,i.g,i.b),9999)}leftHandler(e,i){let r=i.transformCoordinates.getCatesian3FromPX(e.position);if(r&&r.x){i.linePositions.length===1&&i.linePositions.push(r.clone());const t=i.transformCoordinates.transformCartesianToWGS84(r);i.trackList.push([t.lng,t.lat]),i.linePositions.push(r)}}rightHandler(e,i,r){let t=i.transformCoordinates.getCatesian3FromPX(e.position);if(t&&t.x){const a=i.transformCoordinates.transformCartesianToWGS84(t);i.trackList.push([a.lng,a.lat]),i.linePositions.pop(),i.linePositions.push(t)}this.removeUI(),setTimeout(()=>{this.createBtnConfirm(t,r)}),this.removeGisHandler()}createBtnConfirm(e,i){this.iconSize=45;const r=document.querySelector("#cesiumContainer .cesium-viewer"),t=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,e);this.left=t.x,this.top=t.y;const a=this.createConfirmBtn();r.appendChild(a),this.confirmHandler=new Cesium.ScreenSpaceEventHandler(a),this.createConfirmHandler(i);const s=this.createCancelBtn();r.appendChild(s),this.cancelHandler=new Cesium.ScreenSpaceEventHandler(s),this.createCancelHandler()}createConfirmBtn(){const e=document.createElement("div");return e.setAttribute("id","floatUI-confirm"),e.style.position="absolute",e.style.width=this.iconSize+"px",e.style.height=this.iconSize+"px",e.style.left=this.left-this.iconSize/2+"px",e.style.top=this.top+"px",e.style.backgroundSize="100% 100%",e.style.borderRadius="45px",e.setAttribute("title","\u786E\u8BA4"),e}createConfirmHandler(e){const i=this;this.confirmHandler.setInputAction(r=>{e({positions:i.linePositions,entity:i.lineEntity}),this.handleUI("none")},Cesium.ScreenSpaceEventType.LEFT_DOWN)}createCancelBtn(){const e=document.createElement("div");return e.setAttribute("id","floatUI-cancel"),e.style.position="absolute",e.style.width=this.iconSize+"px",e.style.height=this.iconSize+"px",e.style.left=this.left+this.iconSize/2+"px",e.style.top=this.top+"px",e.style.backgroundImage=`url(${lCancelIcon})`,e.style.backgroundSize="100% 100%",e.style.borderRadius="45px",e.setAttribute("title","\u53D6\u6D88"),e}createCancelHandler(){this.cancelHandler.setInputAction(e=>{this.viewer.entities.remove(this.lineEntity),this.handleUI("none")},Cesium.ScreenSpaceEventType.LEFT_DOWN)}removeUI(){document.getElementById("floatUI-cancel")&&document.getElementById("floatUI-cancel").remove(),document.getElementById("floatUI-confirm")&&document.getElementById("floatUI-confirm").remove()}handleUI(e){document.getElementById("floatUI-cancel")&&(document.getElementById("floatUI-cancel").style.display=e),document.getElementById("floatUI-confirm")&&(document.getElementById("floatUI-confirm").style.display=e)}movingHandler(e,i){let r=i.transformCoordinates.getCatesian3FromPX(e.endPosition);i.linePositions.length===1?r&&r.x&&i.linePositions.push(r):i.linePositions.length>=2&&r&&r.x&&(i.linePositions.pop(),i.linePositions.push(r))}removeGisHandler(){this.handler&&(this.handler.destroy(),this.handler=null)}}let G;const ze=new Uint8Array(16);function Ge(){if(!G&&(G=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!G))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return G(ze)}const v=[];for(let o=0;o<256;++o)v.push((o+256).toString(16).slice(1));function We(o,e=0){return v[o[e+0]]+v[o[e+1]]+v[o[e+2]]+v[o[e+3]]+"-"+v[o[e+4]]+v[o[e+5]]+"-"+v[o[e+6]]+v[o[e+7]]+"-"+v[o[e+8]]+v[o[e+9]]+"-"+v[o[e+10]]+v[o[e+11]]+v[o[e+12]]+v[o[e+13]]+v[o[e+14]]+v[o[e+15]]}const je=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var oe={randomUUID:je};function ne(o,e,i){if(oe.randomUUID&&!e&&!o)return oe.randomUUID();o=o||{};const r=o.random||(o.rng||Ge)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=r[t];return e}return We(r)}$(()=>b.state.userInfos.status);const $e=$(()=>b.state.userInfos.startTime),Je=$(()=>b.state.userInfos.endTime);function qe(){window.viewer.clock.onTick.addEventListener(o=>{const e=new Date(o.currentTime.toString()).getTime();b.dispatch("userInfos/CHANGE_CURRENT",Re(new Date(o.currentTime.toString())));const i=$e.value;Je.value,Ke(e,i);const r=window.viewer.entities.values;Ze(o,r),r&&r.forEach(t=>{var a,s;t.userData&&((a=t.userData)!=null&&a.action&&t.userData.action.forEach(async n=>{var m;const c=t.userData.side==="\u7EA2\u65B9"?"red":"blue",d=t.userData.side==="\u7EA2\u65B9"?{r:255,g:0,b:0}:{r:0,g:0,b:255};if(n.type==="attack"&&n.target){const l=g(t.id+"_"+n.target.id+"_"+n.attack_mode),u=g(n.target.id+"_explosion");let I=`${c}Power`;switch(n.attack_mode){case"\u76F4\u7784":if(e>=i+n.time*1e3&&e<=i+(n.time+n.duration)*1e3){const p=g(n.target.id);p&&(u?console.log("_explosion",u):A(p,n.target.id+"_explosion")),l?l.show=!0:p&&t&&(new M({id:t.id+"_"+n.target.id+"_"+n.attack_mode,positions:[t.position.getValue(o.currentTime),p.position.getValue(o.currentTime)],entities:[t,p]},I,d),console.log("\u52A0\u8F7D\u52A8\u6001\u7EBF",t.id+"_"+n.target.id+"_"+n.attack_mode))}else l&&h(l),u&&h(u);break;case"\u95F4\u7784":if(e>=i+n.time*1e3&&e<=i+(n.time+n.duration)*1e3){const p=g(n.target.id);p&&(u||A(p,n.target.id+"_explosion")),l?l.show=!0:p&&t&&new M({id:t.id+"_"+n.target.id+"_"+n.attack_mode,positions:[t.position.getValue(o.currentTime),p.position.getValue(o.currentTime)],entities:[t,p]},"jt9",d)}else l&&h(l),u&&h(u);break;case"\u6A59\u8272":if(e>=i+n.time*1e3&&e<=i+(n.time+n.duration)*1e3){const p=g(n.target.id);p&&(u||A(p,n.target.id+"_explosion")),l?l.show=!0:p&&t&&(I="oArrow",new M({id:t.id+"_"+n.target.id+"_"+n.attack_mode,positions:[t.position.getValue(o.currentTime),p.position.getValue(o.currentTime)],entities:[t,p]},I,{r:255,g:165,b:0}),console.log("\u52A0\u8F7D\u52A8\u6001\u7EBF",t.id+"_"+n.target.id+"_"+n.attack_mode))}else l&&h(l),u&&h(u);break;case"\u7EFF\u8272":if(e>=i+n.time*1e3&&e<=i+(n.time+n.duration)*1e3){const p=g(n.target.id);p&&(u||A(p,n.target.id+"_explosion")),l?l.show=!0:p&&t&&(I="greenArrow",new M({id:t.id+"_"+n.target.id+"_"+n.attack_mode,positions:[t.position.getValue(o.currentTime),p.position.getValue(o.currentTime)],entities:[t,p]},I,{r:85,g:229,b:14}),console.log("\u52A0\u8F7D\u52A8\u6001\u7EBF",t.id+"_"+n.target.id+"_"+n.attack_mode))}else l&&h(l),u&&h(u);break}}else if(n.type==="patrol")e>=i+n.start_time*1e3&&e<=i+n.end_time*1e3?t.label.text=`\u5DE1\u903B\u4E2D... 
 ${t.userData.name}`:t.label.text=`${t.userData.name}`;else if(n.type==="scout")if(t.ellipse.semiMajorAxis=n.radius,t.ellipse.semiMinorAxis=n.radius,e>=i+n.start_time*1e3&&e<=i+n.end_time*1e3){if(t.ellipse.show=!0,(m=t.position)!=null&&m.getValue(o.currentTime)){const l=Y(t.position.getValue(o.currentTime));Qe(l,n.radius)}}else t.ellipse.show=!1;else if(n.type==="support"){const l=g(t.id+"_\u4FDD\u969C\u533A");if(e>=i+n.start_time*1e3&&e<=i+n.end_time*1e3)if(l)l.show=!0;else{const u=et(t.position.getValue(o.currentTime));window.viewer.entities.add({id:t.id+"_\u4FDD\u969C\u533A",position:k.fromDegrees(u.lng,u.lat,u.alt+100),plane:{plane:new se(k.UNIT_Z,0),dimensions:new J(n.radius,n.radius*.6),material:new j({image:"./bz.png",transparent:!0}),fill:!0,outline:!0,outlineColor:U.BLACK}})}else l&&h(l)}else if(n.type!=="transfer"){if(n.type==="defense"){const l=g(t.id+"_"+n.type+"_"+n.attack_mode);if(e>=i+n.time*1e3&&e<=i+(n.time+n.duration)*1e3)if(l)l.show=!0;else{let u=0,I=1;window.viewer.entities.add({id:t.id+"_"+n.type+"_"+n.attack_mode,position:t.position.getValue(o.currentTime),rotation:new L(function(){return u+=I,(u>=360||u<=-360)&&(u=0),O.toRadians(u)},!1),ellipsoid:{radii:new k(40,40,40),maximumCone:O.PI_OVER_TWO,material:new j({image:"./transparent.png",transparent:!0}),outline:!0}})}else l&&h(l)}}}),(s=t.userData)!=null&&s.intention&&t.userData.intention.forEach(async n=>{const c=t.userData.side==="\u7EA2\u65B9"?"red":"blue";if(n.type==="attack"){const d=g(t.id+"_"+n.target.id+"_"+n.attack_mode),m=g(n.target.id+"_explosion");let l=`${c}DashPower`;switch(n.attack_mode){case"\u76F4\u7784":if(e>=i+n.time*1e3&&e<=i+(n.time+n.duration)*1e3){const u=g(n.target.id);u&&(m||A(u,n.target.id+"_explosion")),d?d.show=!0:u&&t&&(new M({id:t.id+"_"+n.target.id+"_"+n.attack_mode,positions:[t.position.getValue(o.currentTime),u.position.getValue(o.currentTime)],entities:[t,u]},l,{r:255,g:255,b:255}),console.log("\u52A0\u8F7D\u52A8\u6001\u7EBF",t.id+"_"+n.target.id+"_"+n.attack_mode))}else d&&h(d),m&&h(m);break;case"\u95F4\u7784":if(e>=i+n.time*1e3&&e<=i+(n.time+n.duration)*1e3){const u=g(n.target.id);u&&(m||A(u,n.target.id+"_explosion")),d?d.show=!0:u&&t&&new M({id:t.id+"_"+n.target.id+"_"+n.attack_mode,positions:[t.position.getValue(o.currentTime),u.position.getValue(o.currentTime)],entities:[t,u]},"jt9",color)}else d&&h(d),m&&h(m);break}}else if(n.type==="patrol")e>=i+n.start_time*1e3&&e<=i+n.end_time*1e3?t.label.text=`\u5DE1\u903B\u4E2D... 
 ${t.userData.name}`:t.label.text=`${t.userData.name}`;else if(n.type==="transfer"){const d=g(t.id+"_transfer");if(e>=i+n.time*1e3&&e<=i+(n.time+n.duration)*1e3){if(d)d.show=!0;else if(n.route){const m=[];n.route.forEach(l=>{m.push(l.coordinate.longitude),m.push(l.coordinate.latitude),m.push(l.coordinate.altitude)}),new M({id:t.id+"_transfer",positions:k.fromDegreesArrayHeights(m),entities:[]},"blueDashArrow",{r:255,g:255,b:255})}}else d&&h(d)}else if(n.type==="defense"){const d=g(t.id+"_"+n.type+"_"+n.attack_mode);if(e>=i+n.time*1e3&&e<=i+(n.time+n.duration)*1e3)if(d)d.show=!0;else{let m=0,l=1;window.viewer.entities.add({id:t.id+"_"+n.type+"_"+n.attack_mode,position:t.position.getValue(o.currentTime),rotation:new L(function(){return m+=l,(m>=360||m<=-360)&&(m=0),O.toRadians(m)},!1),ellipsoid:{radii:new k(40,40,40),maximumCone:O.PI_OVER_TWO,material:new j({image:"./transparent.png",transparent:!0}),outline:!0}})}else d&&h(d)}}))})})}let W=[];const Ke=(o,e)=>{const i=window.viewer.entities.values,r=document.querySelector(".sc-user-input--text"),t=100;timeCamera.forEach(a=>{if(a.videoUrl&&!b.state.videoUrl){if(o>=e+a.start*1e3){window.viewer.clock.shouldAnimate=!1,b.CHANGE_VIDEOISSHOW(!0),b.CHANGE_VIDEOURL(a.videoUrl);return}}else{if(a.input&&o>=e+a.time*1e3-a.input.length*t-3e3&&!a.inputLoaded){a.inputLoaded=!0;let s=0;const n=setInterval(()=>{if(s>=a.input.length){clearInterval(n);return}r&&(r.innerHTML+=a.input[s++])},t)}if(o>=e+a.time*1e3&&!a.loaded){if(console.log(a),a.pause?(window.viewer.clock.shouldAnimate=!1,setTimeout(()=>{window.viewer.clock.shouldAnimate=!0},a.duration_time*1e3)):window.viewer.clock.shouldAnimate=!0,W.length&&(W.forEach(s=>{Ne(s)}),W=[]),r&&(r.innerHTML=""),i.forEach(s=>{var n,c,d,m,l;if((n=s.userData)!=null&&n.divId&&((d=document.getElementById((c=s.userData)==null?void 0:c.divId))==null||d.remove()),s.id.indexOf("-point")>-1){const u=g((m=s.userData)==null?void 0:m.id);if(u){console.log("\u6062\u590Dlabel");const I=((l=u.userData)==null?void 0:l.side)==="\u7EA2\u65B9"?"rgba(252,8,8,0.52)":"rgba(8,93,252,0.52)";u.label.backgroundColor=U.fromCssColorString(I).withAlpha(.8)}h(s)}}),a.loaded=!0,a.camera&&le(a.camera),a.area&&a.area.forEach((s,n)=>{Ye(s,"area"+(n+1),"\u533A\u57DF"+(n+1))}),a.id&&Xe(a.id),a.type==="detailInfo"){let s=[];s.push({name:"\u540D\u79F0",value:Object.keys(a.data)[0]}),Object.keys(a.data[Object.keys(a.data)]).forEach(n=>{s.push({name:n,value:a.data[Object.keys(a.data)][n]})}),console.log(s),b.CHANGE_PROPERTIES(s)}a.type==="wastage"&&a.data&&i.forEach(s=>{Object.keys(a.data).forEach(n=>{var c;if(n===((c=s.userData)==null?void 0:c.id)){s.userData.divId=ne();let d=`<div class="divEntityMark">
                  <div class="blood">
                    <div style="width: ${a.data[n].\u635F\u8017\u60C5\u51B5*100}%"></div>
                  </div>
              </div>
                  <div class="divEntityMarkFooter"><div class="trangle"></div></div>`;re(s.userData.divId,d)}})}),a.type==="threatLevel"&&i.forEach(s=>{Object.keys(a.data).forEach(n=>{var c;if(n===((c=s.userData)==null?void 0:c.id)){let d="blueArrow";W.push(s.userData.id+a.id),new M({id:s.userData.id+a.id,positions:[g(s.userData.id).position.getValue(o),g(a.id).position.getValue(o)],entities:[g(s.userData.id),g(a.id)]},d,{r:255,g:255,b:255}),s.userData.divId=ne();let m=`<div class="divEntityMark">

                  <div class="threat">
                    <div style="width: ${a.data[n].\u5A01\u80C1\u7A0B\u5EA6*100}%">${Number(a.data[n].\u5A01\u80C1\u7A0B\u5EA6).toFixed(2)*100}</div>
                  </div>
              </div>
                  <div class="divEntityMarkFooter"><div class="trangle"></div></div>`;re(s.userData.divId,m)}})})}}})},Xe=o=>{var a;let e=1,i=!0;const r=g(o),t=g(o+"-point");if(r){const s=((a=r.userData)==null?void 0:a.side)==="\u7EA2\u65B9"?"rgb(255,0,0)":"rgb(0,41,246)";r.label.backgroundColor=new L(()=>(i?(e=e-.05,e<=0&&(i=!1)):(e=e+.05,e>=1&&(i=!0)),U.fromCssColorString(s).withAlpha(e)),!1),t||window.viewer.entities.add({id:o+"-point",userData:{id:o},name:"\u5706\u70B9point\u95EA\u70C1",show:!1,position:r.position.getValue(window.viewer.clock.currentTime)})}},Ye=(o,e,i)=>{const r=g(e);r?r.show=!0:window.viewer.entities.add({id:e,name:i,position:k.fromDegrees(o.longitude,o.latitude,o.altitude+100),plane:{plane:new se(k.UNIT_Z,0),dimensions:new J(400,300),material:new j({image:"./"+e+".png",transparent:!0}),fill:!0,outline:!0,outlineColor:U.BLACK}})},re=(o,e)=>{const i=document.createElement("div");i.style.position="absolute",i.style.color="#fff",i.innerHTML=e,i.id=o,window.viewer.container.appendChild(i)},Ze=(o,e)=>{const i=new k,r=new J;let t=!0;e.forEach(a=>{var n;const s=document.getElementById((n=a.userData)==null?void 0:n.divId);if(s){let c,d;if(a.position&&(c=a.position.getValue(o.currentTime,i)),c&&(d=be.wgs84ToWindowCoordinates(window.viewer.scene,c,r)),d){const m=s.clientWidth,l=s.clientHeight;s.style.left=d.x-m/2+"px",s.style.top=d.y-l/2+"px",t||(t=!0,s.style.display="block")}else t&&(t=!1,s.style.display="none")}})},Qe=(o,e)=>{window.viewer.entities.values.filter(r=>{var t;return((t=r==null?void 0:r.userData)==null?void 0:t.side)==="\u84DD\u65B9"}).forEach(r=>{const t=Y(r.position.getValue(window.viewer.clock.currentTime)),a=ee([o.longitude,o.latitude]),s=ee([t.longitude,t.latitude]);Ae(a,s,{units:"meters"})<e&&(r.show||(r.show=!0,timeCamera.filter(c=>{var d;return((d=c.input)==null?void 0:d.indexOf("\u5C55\u5F00\u60C5\u62A5\u4FA6\u5BDF"))>-1})))})},et=o=>{if(!o)return;let i=xe.WGS84.cartesianToCartographic(o);return{lng:O.toDegrees(i.longitude),lat:O.toDegrees(i.latitude),alt:i.height}},A=(o,e)=>{let i=16,r=!1,t=7,a=!1;window.viewer.entities.add({id:e,show:!0,billboard:{pixelOffset:new J(0,24),eyeOffset:new k(0,0,0),horizontalOrigin:Ie.CENTER,verticalOrigin:De.BOTTOM,image:"/explosion.png",width:new L(()=>(r?(i=i-.8,i<=16&&(i=16,r=!1)):(i=i+.8,i>=160&&(i=160,r=!0)),i),!1),height:new L(()=>(a?(t=t-.8*(70/160),t<=7&&(t=7,a=!1)):(t=t+.8*(70/160),t>=70&&(t=70,a=!0)),t),!1)},position:new L(()=>o.position.getValue(window.viewer.clock.currentTime),!1)})};const tt=o=>(ye("data-v-78389728"),o=o(),_e(),o),it={id:"sceneViewer","element-loading-text":"\u6B63\u5728\u521B\u5EFA",class:"scene-viewer"},ot=tt(()=>D("div",{id:"rightProperty"},null,-1)),nt={id:"currentTime"},rt={id:"entityProperty"},at={class:"flex-left"},st={style:{"max-width":"150px"}},lt=["src"],dt=ae("\u751F\u6210\u8DEF\u5F84"),ut=ae("\u53D6\u6D88"),ct={key:0,class:"text-bottom"},mt=Te('<div id="legend" class="divEntityMark" data-v-78389728><div class="flex-left align-center" data-v-78389728><div style="margin-bottom:10px;margin-right:5px;color:#fff;" data-v-78389728>\u635F\u8017\u60C5\u51B5</div><div class="blood" data-v-78389728><div style="width:80%;" data-v-78389728></div></div></div><div class="flex-left align-center" data-v-78389728><div style="margin-bottom:40px;color:#fff;" data-v-78389728>\u5A01\u80C1\u7A0B\u5EA6</div><div class="threat" data-v-78389728><div style="width:80%;" data-v-78389728>80</div></div></div></div>',1),ft={setup(o){const e=$(()=>b.state.userInfos),i=S(!0);S(["#C233FD","#712DE3","#463FFA","#376AE6","#33BDFD","#1de8d6"]);const r=S(""),t=new Date("2024-03-01 00:00:00").getTime(),a=t+20*60*1e3,s=S(),n=S();S(!1);const c=S(!1),d=()=>{window.viewer.clock.shouldAnimate=!0},m=()=>{const E=JSON.parse(r.value),f=window.viewer.entities.getById("route1");f&&window.viewer.entities.remove(f);const w=window.viewer.entities.add({id:"route1",polyline:{clampToGround:!0,width:3,material:Cesium.Color.fromCssColorString("#f00"),positions:Cesium.Cartesian3.fromDegreesArray(E)}});window.viewer.zoomTo(w),c.value=!1},l=S({destination:{x:-2.5606726562583237e6,y:4593375433256215e-9,z:3.5979978972890284e6},orientation:{heading:.052803580696170194,pitch:-1.569757112554158,roll:0}}),u=()=>{l.value=ke(),console.log("\u5F53\u524D\u89C6\u89D2\u548C\u76F8\u673A\u4F4D\u7F6E",JSON.stringify(l.value))},I=()=>{le(l.value)},p=()=>{c.value=!1},de=E=>{E.setInputAction(f=>{var x;const w=window.viewer.scene.pick(f.position);if(Cesium.defined(w))if(Cesium.defined(w.id)){console.log(w.id),s.value=w.id,((x=w.id.userData)==null?void 0:x.side)==="\u7EA2\u65B9"&&(n.value=w.id);const _=Y(w.id.position.getValue(window.viewer.clock.currentTime));console.log(w.id.id,_)}else{s.value=null;const _=window.viewer.scene.pickPosition(f.position);if(Cesium.defined(_)){const y=Cesium.Cartographic.fromCartesian(_),P=Cesium.Math.toDegrees(y.longitude),C=Cesium.Math.toDegrees(y.latitude),q=y.height,K={longitude:Number(P.toFixed(6)),latitude:Number(C.toFixed(6)),altitude:Number(q.toFixed(2))};console.log("\u7ECF\u7EAC\u5EA6",K)}}else{s.value=null;const _=window.viewer.scene.globe.ellipsoid,y=window.viewer.camera.pickEllipsoid(f.position,_);if(y){const P=_.cartesianToCartographic(y),C=Cesium.Math.toDegrees(P.longitude),q=Cesium.Math.toDegrees(P.latitude),K=P.height,pe={longitude:Number(C.toFixed(6)),latitude:Number(q.toFixed(6)),altitude:Number(K.toFixed(2))};console.log("\u7ECF\u7EAC\u5EA6",pe)}}},Cesium.ScreenSpaceEventType.LEFT_CLICK)},Z=S([]),ue=E=>{E.setInputAction(f=>{const w=window.viewer.scene.pick(f.endPosition);if(Cesium.defined(w)&&Cesium.defined(w.id)){const x=w.id.userData;if(!x)return;const _=[];Object.keys(x).forEach(y=>{entityMap[y]&&(entityMap[y]==="\u60C5\u62A5\u6765\u6E90"?_.push({name:entityMap[y],value:sourceMap[x[y]]}):_.push({name:entityMap[y],value:x[y]}))}),Z.value=_,document.getElementById("entityProperty").style.left=f.endPosition.x+20+"px",document.getElementById("entityProperty").style.top=f.endPosition.y+20+"px"}else Z.value=[]},Cesium.ScreenSpaceEventType.MOUSE_MOVE)},ce=E=>{E.forEach(f=>{new Be(f)})};ge(async()=>{b.dispatch("userInfos/CHANGE_START",t),b.dispatch("userInfos/CHANGE_END",a),window.viewer=He("sceneViewer");const E=Cesium.JulianDate.fromDate(new Date(t)),f=Cesium.JulianDate.fromDate(new Date(a));window.viewer.clock.startTime=E.clone(),window.viewer.clock.stopTime=f.clone(),window.viewer.clock.currentTime=E.clone(),Fe(),Ue(new Date(t),new Date(a)),document.querySelector(".cesium-viewer-bottom").style.display="none",ce(jsonData);const w=new Cesium.ScreenSpaceEventHandler(window.viewer.scene.canvas);de(w),ue(w),window.viewer.clock.shouldAnimate=!1,setTimeout(()=>{i.value=!1,qe()},1e3),setTimeout(()=>{window.viewer.clock.shouldAnimate=!0},5e3),I()});const me=()=>{window.viewer.clock.shouldAnimate=!1},fe=()=>{window.viewer.clock.shouldAnimate=!0};return(E,f)=>{var P;const w=X("el-dialog"),x=X("el-input"),_=X("el-button"),y=Ee("loading");return Q((R(),N("div",it,[D("div",{id:"start",class:"cesiumBtn",onClick:fe},"\u5F00\u59CB"),D("div",{id:"rotate",class:"cesiumBtn",onClick:f[0]||(f[0]=C=>u())},"\u83B7\u53D6\u5F53\u524D\u89C6\u89D2"),D("div",{id:"pause",class:"cesiumBtn",onClick:me},"\u6682\u505C"),D("div",{id:"reset",class:"cesiumBtn",onClick:f[1]||(f[1]=(...C)=>E.initTime&&E.initTime(...C))},"\u91CD\u7F6E"),ot,D("div",nt,"\u5F53\u524D\u65F6\u95F4\uFF1A"+F(V(e).current),1),Q(D("div",rt,[(R(!0),N(we,null,he(V(e).properties||[],C=>(R(),N("div",at,[D("div",null,F(C.name)+"\uFF1A",1),D("div",st,F(C.value),1)]))),256))],512),[[ve,(P=V(e).properties)==null?void 0:P.length]]),B(w,{modelValue:V(e).showVideo,"onUpdate:modelValue":f[2]||(f[2]=C=>V(e).showVideo=C),title:"\u89C6\u9891\u4ECB\u7ECD",center:"",width:"50%"},{default:H(()=>[D("video",{style:{width:"100%"},controls:"",ref:"videoIntroduce",autoplay:!0,src:V(e).videoUrl,onEnded:d},null,40,lt)]),_:1},8,["modelValue"]),B(w,{modelValue:c.value,"onUpdate:modelValue":f[5]||(f[5]=C=>c.value=C),title:"\u5730\u5F62\u673A\u52A8\u901A\u9053",width:"30%","before-close":p},{footer:H(()=>[B(_,{type:"primary",onClick:m},{default:H(()=>[dt]),_:1}),B(_,{onClick:f[4]||(f[4]=C=>c.value=!1)},{default:H(()=>[ut]),_:1})]),default:H(()=>[B(x,{modelValue:r.value,"onUpdate:modelValue":f[3]||(f[3]=C=>r.value=C),type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"\u590D\u5236\u5730\u5F62\u901A\u9053\u6570\u636E\u5230\u6B64\u5904(\u793A\u4F8B\uFF1A[118.321596,33.954025,118.322679,33.953933,118.323891, 33.95405])"},null,8,["modelValue"])]),_:1},8,["modelValue"]),V(e).mapText?(R(),N("div",ct,F(V(e).mapText),1)):Ce("",!0),mt])),[[y,i.value]])}}};var ht=Se(ft,[["__scopeId","data-v-78389728"]]);export{ht as default};
